# Task 및 BackStack(백스택) 이해

## Launch mode (실행 모드)
### manifest 파일 사용
---
#### 1. `standard`*(default)*
- 시스템은 액티비티가 시작된 태스크에 액티비티의 새 인스턴스를 생성하고 인텐트를 인스턴스로 라우팅합니다.
- 액티비티는 여러 번 인스턴스화될 수 있습니다.
- 각 인스턴스는 서로 다른 태스크에 속할 수 있으며 한 태스크에는 여러 인스턴스가 있을 수 있습니다.
- 예제
  1. 모든 액티비티가 standard 이고, A -> B -> B 순으로 호출한 경우 (A - B - B)
---
#### 2. `singleTop`
- 액티비티의 인스턴스가 이미 현재 작업의 맨 위에 있으면 시스템은 액티비티의 새 인스턴스를 생성하지 않습니다.
- `onNewIntent()` 메서드를 호출하여 인텐트를 기존 인스턴스로 라우팅합니다.
- 액티비티는 여러 번 인스턴스화될 수 있습니다.
- 각 인스턴스는 서로 다른 태스크에 속할 수 있으며 한 작업에는 여러 인스턴스가 있을 수 있습니다.  
  (단, 백스택의 맨 위에 있는 액티비티가 액티비티의 기존 인스턴스가 아닐때만)
- 예제
  1. B가 singleTop 으로 선언되어 있고, A -> B -> B 순으로 호출한 경우 (A - B)
  2. B가 singleTop 으로 선언되어 있고, A -> B -> A 순으로 호출한 경우 (A - B - A)
---
#### 3. `singleTask`
- 시스템이 새 태스크를 생성하고 새 태스크의 루트에 있는 액티비티를 인스턴스화 합니다.
- 그러나 액티비티의 인스턴스가 이미 별도의 태스크에 있다면 시스템은 새 인스턴스를 생성하지 않고, `onNewIntent()` 메서드를 호출하여 인텐트를 기존 인스턴스로 라우팅합니다.
- 태스크의 인스턴스가 한번에 하나만 존재할 수 있습니다.
---
#### 4. `singleInstance`
- `singleTask` 와 동일하지만 시스템이 인스턴스를 보유한 태스크로는 어떤 다른 액티비티도 실행하지 않는다는 점이 다릅니다.
- `singleInstance`로 설정된 액티비티는 항상 한 태스크에 하나의 액티비티만 존재합니다.
- 이 액티비티도 시작된 모든 액티비티는 별도의 태스크로 열립니다.
---
</br>  

### intent flag 사용
> 액티비티를 시작할 때 `startActivity()` 에 전달하는 인텐트에 플래그를 포함시켜서 사용합니다.
---
#### 1. `FLAG_ACTIVITY_NEW_TASK`
- `singleTask` 런치모드와 동일한 동작이 발생합니다.
---
#### 2. `FLAG_ACTIVITY_SINGLE_TOP`
- `singleTop` 런치모드와 동일한 동작이 발생합니다.
---
#### 3. `FLAG_ACTIVITY_CLEAR_TOP`
- 시작하는 액티비티가 현재 태스크에서 이미 실행중이면 액티비티의 새 인스턴스가 실행되는 대신 태스크의 맨 위에 있는 다른 모든 액티비티가 제거되고 이 인텐트가 `onNewIntent()` 를 통해 액티비티(이제 맨 위에 있음)의 다시 시작된 인스턴스로 전달됩니다.
- 런치모드에 동일한 동작을 하는 속성값은 없습니다.
- `FLAG_ACTIVITY_CLEAR_TOP` 은 `FLAG_ACTIVITY_NEW_TASK` 와 함께 가장 자주 사용됩니다.  
  (이러한 플래그를 함께 사용하면 또 다른 태스크에 있는 기존 액티비티를 찾아 인텐트에 응답할 수 있는 위치에 액티비티를 넣을 수 있습니다.)
---
</br>  

## 어피티니 처리
- 기본적으로 동일한 앱의 모든 액티비티는 동일한 태스크 안에 있습니다.
- 하지만 액티비티의 기본 어피니티를 수정할 수 있습니다.
- 서로 다른 앱에 정의돈 액티비티가 어피니티를 공유할 수 있습니다.
- 또는 동일한 앱에 정의된 액티비티에 다양한 태스크 어피니티를 할당할 수 있습니다.
- `<activity>`요소의 `taskAffinity`속성을 통해 어피니티를 수정할 수 있습니다.
- `FLAG_ACTIVITY_NEW_TASK` 로 액티비티를 시작할 때, 새 액티비티와 동일한 어피니티를 가진 기존 태스크가 있으면 그 태스크로 실행되고, 없다면 새 태스크를 시작합니다.
